<!DOCTYPE HTML>
<html lang="ru-RU" class="no-js">
  <head>
    <title>Календарь / SkyCampus</title>
    <!--#include virtual="/views/layouts/_head.html" -->
  </head>
  <body>
    <!--#include virtual="/views/layouts/_alerts.html" -->
    <!--#include virtual="/views/layouts/_header.html" -->
    <!--#include virtual="/views/layouts/_sidebar.html" -->
    <nav id="nav" class="nav clearfix">
      <div class="f-l">
        <a href="#" class="nav_a nav_prev" data-nav="prev"></a><span class="nav_current">Август 2013</span><a href="#" class="nav_a nav_next" data-nav="next"></a>
      </div>
      <div class="f-r">
        <a href="#" class="form_button __color __s cols-2" id="today-button" style="margin-right: 2rem;">Сегодня</a>
        <menu class="nav_menu __color" id="calendar-view">
          <li class="nav_menu_i"><a href="#" class="nav_menu_i_a" data-view="agendaDay">День</a></li>
          <li class="nav_menu_i"><a href="#" class="nav_menu_i_a __current" data-view="agendaWeek">Неделя</a></li>
          <li class="nav_menu_i"><a href="#" class="nav_menu_i_a" data-view="month">Месяц</a></li>
        </menu>
      </div>
    </nav>
    <section id="section" class="section" role="main">
      <div class="calendar">
        <nav class="calendar_nav clearfix m-b_2">
          <div class="f-l calendar_nav_checkbox">
            <label class="form_label calendar_nav_checkbox_i">
              <span class="form_checkbox form_el __fake"><input type="checkbox" class="form_checkbox form_el __real"></span>Учебный
            </label>
            <label class="form_label calendar_nav_checkbox_i">
              <span class="form_checkbox form_el __fake"><input type="checkbox" class="form_checkbox form_el __real"></span>Личный
            </label>
          </div>
          <div class="f-r">
            <menu class="nav_menu __default calendar_nav_menu">
              <li class="nav_menu_i"><a href="#" class="nav_menu_i_a">Все</a></li>
              <li class="nav_menu_i"><a href="#" class="nav_menu_i_a">Лекции</a></li>
              <li class="nav_menu_i"><a href="#" class="nav_menu_i_a">Семинары</a></li>
              <li class="nav_menu_i"><a href="#" class="nav_menu_i_a">Прочее</a></li>
            </menu>
            <a href="#" class="form_button __default __s calendar_nav_button cols-2"><b>+</b> Создать событие</a>
            <a href="#" class="form_button __default __s calendar_nav_button __settings"><i class="ico-16 __settings"></i></a>            
          </div>
        </nav>
        <div id="calendar"></div>
      </div>
    </section>
    <!--#include virtual="/views/layouts/_footer.html" -->

    <script type="text/javascript">
      $(function() {

        var date = new Date();
        var d = date.getDate();
        var m = date.getMonth();
        var y = date.getFullYear();
        
        $('#calendar').fullCalendar({
          header: false,
          defaultView: 'agendaWeek',
          firstDay: 1,
          firstHour: 8,
          axisFormat: 'H:mm',
          events: '/data/feed.json',
          timeFormat: 'H:mm{ - H:mm}',
          editable: false,
          allDayText: 'День',
          monthNames: ['Январь','Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'],
          monthNamesShort: ['Янв.','Фев.','Март','Апр.','Май','Июнь','Июль','Авг.','Сент.','Окт.','Ноя.','Дек.'],
          dayNames: ['Воскресенье','Понедельник','Вторник','Среда','Четверг','Пятница','Суббота'],
          dayNamesShort: ['ВС','ПН','ВТ','СР','ЧТ','ПТ','СБ'],
          viewDisplay: function(view) {
            getTitle();
            var first = true;
            if (first) {
              first = false;
            } else {
              window.clearInterval(timelineInterval);
            }
            timelineInterval = window.setInterval(setTimeline, 60000);
            try {
              setTimeline();
            } catch(err) {}
          }
        });

        // Next & Prev click
        $('#nav').find('.nav_a').click(function() {
          $('#calendar').fullCalendar($(this).data('nav'));
          getTitle();
          return false;
        });

        // Today click
        $('#today-button').click(function() {
          $('#calendar').fullCalendar('today');
          getTitle();
          return false;
        });        

        // View click
        $('#calendar-view').find('.nav_menu_i_a').click(function() {
          var view = $(this).data('view');
          $('#calendar').fullCalendar('changeView', view);
          $('.nav_menu').find('.__current').removeClass('__current');
          $(this).addClass('__current');
          getTitle();
          return false;
        });

        function getTitle() {
          var view = $('#calendar').fullCalendar('getView');
          $('#nav').find('.nav_current').html(view.title);  
        }

        function setTimeline(view) {
          var parentDiv = jQuery(".fc-agenda-slots:visible").parent();
          var timeline = parentDiv.children(".timeline");
          if (timeline.length == 0) { //if timeline isn't there, add it
            timeline = jQuery("<hr>").addClass("timeline");
            parentDiv.prepend(timeline);
          }

          var curTime = new Date();

          var curCalView = jQuery("#calendar").fullCalendar('getView');
          if (curCalView.visStart < curTime && curCalView.visEnd > curTime) {
            timeline.show();
          } else {
            timeline.hide();
            return;
          }

          var curSeconds = (curTime.getHours() * 60 * 60) + (curTime.getMinutes() * 60) + curTime.getSeconds();
          var percentOfDay = curSeconds / 86400; //24 * 60 * 60 = 86400, # of seconds in a day
          var topLoc = Math.floor(parentDiv.height() * percentOfDay);

          timeline.css("top", topLoc + "px");
        }        

      });
    </script>

  </body>
</html>